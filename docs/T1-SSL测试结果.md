# galay-ssl 测试结果摘要

## 实际测试数据更新 (2026-02-13)

### 更新结论
- **数据传输**: ✅ 可用（支持大 payload 并发 echo 压测）
- **吞吐量测试**: ✅ 可跑通并产出数据

### 压测验证（本地环回，kqueue，5轮串行）
| 测试场景 | 连接数 | 每连接请求 | payload | 每轮完成请求 | 错误数 | 耗时(ms) 平均 | 耗时最小 | 耗时最大 | QPS 平均 | QPS 最小 | QPS 最大 | 吞吐量(MB/s) 平均 | 吞吐最小 | 吞吐最大 |
|---------|-------|-----------|--------|-------------|-------|--------------|---------|---------|---------|---------|---------|-------------------|---------|---------|
| 小包 QPS | 200 | 500 | 47 B | 100,000 | 0 | 616.4 | 615 | 619 | 162,234 | 161,551 | 162,602 | 14.54 | 14.48 | 14.58 |
| 大包吞吐 | 10 | 200 | 65,536 B | 2,000 | 0 | 126.2 | 125 | 128 | 15,849 | 15,625 | 16,000 | 1,981.10 | 1,953.12 | 2,000.00 |

### 备注
- 本轮优化点：握手/关闭扩容策略、`recv` 的 `WantWrite` 协同发送、io_uring 发送分块流水、`SSL_write` 前清理错误队列。
- 本轮压测口径：`Release + LTO`。
- 上表为同参数 5 轮串行复测统计值（平均 + 最小/最大），用于降低单次抖动影响。
- 最新对照数据（`OpenSSL + libevent`）见 `docs/B1-SSL压测报告.md`。
- `libevent` 压测程序已从仓库移除，仅保留历史基线数据。

## 实际测试数据 (2026-01-03)

### 测试环境
- **平台**: macOS 15.x + Apple M4 ARM64
- **IO后端**: kqueue
- **编译器**: Apple Clang 17.0.0
- **OpenSSL**: 3.5.0

### 功能测试结果
| 测试项目 | 状态 | 详情 |
|---------|------|------|
| 项目编译 | ✅ | galay-ssl库 + benchmark程序 |
| 单元测试 | ✅ | 34/34 通过 (100%) |
| SSL证书生成 | ✅ | 2048位RSA证书链 |
| SSL握手 | ✅ | TLS 1.3握手成功 |
| 数据传输 | ✅ | 支持并发 echo 压测（见 2026-02-13 更新） |

### 性能基准数据
| 指标 | galay-kernel (基准) | galay-ssl (当前) | galay-ssl (预期) |
|------|-------------------|----------------|------------------|
| QPS | 320,799 | N/A (传输未完成) | 200,000-250,000 |
| 接收吞吐量 | 156.64 MB/s | N/A | 120-140 MB/s |
| 发送吞吐量 | 157.33 MB/s | N/A | 120-140 MB/s |
| 握手延迟 | N/A | < 10ms ✅ | < 10ms |
| 内存使用 | ~8KB/连接 | ~50KB/连接 | ~45KB/连接 |
| 错误率 | 0% | 握手0% ✅ | < 1% |

### 关键发现
1. **SSL握手性能优秀**: < 10ms延迟，100%成功率
2. **内存开销合理**: 50KB/连接是SSL协议的正常开销
3. **功能完整性高**: 握手层已完全实现和优化
4. **性能差距可接受**: 预期60-80%的galay-kernel性能是合理目标

### 当前限制
- 更大 payload（例如 1MiB）在高并发下的吞吐量与资源占用仍需进一步评估

### 结论
galay-ssl的核心SSL功能已稳定运行，握手与数据传输均可跑通。建议继续补充不同 payload/连接数/CPU 占用等维度的压测数据，以更接近真实业务评估。
