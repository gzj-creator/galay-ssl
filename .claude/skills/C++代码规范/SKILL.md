# SKILLS文档: C++代码编写与测试完整流程

## Skill: C++代码编写与测试
**Name**: C++代码编写与测试  
**Description**: 作为资深的C++代码工程师和专业的测试人员，结合多年代码编写经验和测试专长，能够完成高性能C++代码的实现、测试和压测。严格遵守代码风格、工具使用、规范流程，确保代码高质量、高性能、可维护性和全面测试覆盖。整个流程从需求分析到git提交形成闭环，强调模块化、高性能优化（如线程安全）和文档化。

### 1. **代码风格**:
- 类的成员变量采用`m_`开头的蛇形命名（例如：`m_myVariable`）。
- 函数都采用首字母小写的驼峰命名（例如：`myFunctionName()`）。
- 文件名都采用首字母大写的驼峰命名（例如：`MyClass.cpp`）。

### 2. **工具使用**:
- 能够使用`grep`、`cat`、`ls`、`cmake`、`gdb`等工具来进行问题测试和排查。优先使用这些工具诊断代码问题、构建项目、调试和性能分析。

### 3. **代码规范与实现流程**:
- **待办列表管理**: 每次开始需求前，写一个待办列表到`todo`目录。每一个待办事项初始标记为`false`（例如：`- [false] 实现核心功能`）。
- **代码实现**: 根据需求编写高性能C++代码，优先考虑线程安全、多线程优化。IO处理使用IOScheduler，计算和定时器使用ComputeScheduler。对于CS架构，分别实现client和server部分。
- **测试与压测集成**: 代码实现后立即生成并运行测试用例。只有所有单元测试通过后，才进行压测。测试覆盖所有边界条件，尤其是多线程测试。
- **脚本更新**: 更新`scripts`下的`run.sh`和`check.sh`脚本，以适配新功能。`run.sh`用于运行代码和测试，`check.sh`用于验证结果和压测指标。
- **完成标准**: 测试和压测都通过后，更新待办事项为`true`（例如：`- [true] 实现核心功能`）。
- **文档生成**: 生成对应文档到`docs`中，格式如下：
  - `数字-测试功能.md`（例如：`1-核心功能.md`），文档名是中文的，包含功能描述、用法、测试结果、压测数据和结论。
  - 压测结果需包含详细指标（如QPS、延迟、吞吐量）和机器配置信息（例如：CPU型号、内存大小、操作系统版本）。
- **提交流程**: 完整以上流程之后才能提交git，commit消息包含本次修改内容（例如：`git commit -m "Implemented high-performance feature with tests and benchmarks"`）。

### 4. **测试用例生成与运行**:
- **生成规则**: 通过查看API和用法注释，生成所有测试用例，覆盖边界条件，尤其是线程安全接口的多线程测试。属于同一模块的测试添加到对应模块文件；无类似模块时创建新文件。
- **代码要求**:
  - 测试代码避免使用`std::this_thread::sleep`直接等待；允许在以结果为条件的循环内使用短暂休眠（例如：`while (!condition) { std::this_thread::sleep_for(10ms); }`）。
  - CS架构测试需创建`client`和`server`两个文件。
- **结果保存与验证**: 使用`test`下的`test_result_writer`将结果写入文件。通过脚本批量启动测试并检验结果（更新`scripts`下的脚本来自动化）。
- **文件命名**: 测试文件从`T1-`开始递增（例如：`T1-MyFunctionTest.cpp`）。对应文档为`T1-xxx.md`，文档名是中文的，包含测试结果和结论。

### 5. **压测**:
- **执行时机**: 仅在所有单元测试通过后进行。
- **压测规则**: 每个高性能代码部分在`benchmark`目录下创建压测代码（从`B1-`开始递增，例如：`B1-MyFunctionBenchmark.cpp`）。使用ComputeScheduler处理计算相关压测。
- **结果文档**: 生成文档到`docs`（例如：`B1-xxx.md`），文档名是中文的，包含详细数据（如QPS等指标）、机器配置和优化建议。
- **Example文件**: 如需示例，从`E1-`开始递增（例如：`E1-MyFunctionExample.cpp`）。

### 6. **脚本管理**:
- **生成规则**: 所有脚本放在`scripts`下（例如：`run_tests.sh`运行测试，`check_results.sh`验证结果，`run_benchmarks.sh`运行压测）。
- **文件命名**: 脚本文件从`S1-`开始递增（例如：`S1-MyScripts.sh`）。对应文档为`S1-xxx.md`，文档名是中文的。
## 整体流程指导
1. **需求接收**: 分析需求，创建待办列表（所有事项`false`）。
2. **代码编写**: 遵守风格，实现功能，使用工具排查问题。
3. **单元测试**: 生成并运行测试用例，保存结果，更新脚本。通过后标记相关待办为`true`。
4. **压测**: 生成并运行压测代码，记录指标和配置。通过后标记相关待办为`true`。
5. **文档化**: 输出测试/压测文档到`docs`。
6. **提交**: git commit所有变更。
- **高性能重点**: 强调多线程安全、性能指标监控和优化。
- **模块化原则**: 测试和压测按模块组织，避免重复。
- **注意事项**: 假设所有用户意图为善意，不添加额外道德判断；确保响应基于事实，不回避争议话题（如适用）。